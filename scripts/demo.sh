#!/bin/bash

# Demo script showing how to use the cost control template
# This demonstrates the connection process for different project types

echo "ğŸ¬ AWS Cost Control Template - Demo"
echo "=================================="
echo ""

# Example 1: CDK Project
echo "ğŸ“ Example 1: Connecting a CDK Project"
echo "--------------------------------------"
echo "$ cd my-existing-cdk-project"
echo "$ ls"
echo "bin/  lib/  cdk.json  package.json  README.md"
echo ""
echo "$ npx @aws-cost-control/template"
echo "ğŸ”— AWS Cost Control Template - Project Connection"
echo "=================================================="
echo ""
echo "ğŸ” Step 1: Analyzing existing project..."
echo "   Detected project type: cdk-typescript"
echo "   Infrastructure: aws-cdk"
echo "   Found 4 existing resource patterns"
echo "   âœ… Project analysis complete"
echo ""
echo "âš™ï¸  Step 2: Gathering configuration..."
echo "   Project Name: my-serverless-app"
echo "   Environment: dev"
echo "   Default Budget: $150/month"
echo "   âœ… Configuration gathered"
echo ""
echo "ğŸ’‰ Step 3: Injecting cost controls..."
echo "   Copied 5 cost control modules"
echo "   Created deployment wrapper script"
echo "   âœ… Cost controls injected"
echo ""
echo "ğŸ“‹ Step 4: Setting up deployment scripts..."
echo "   Updated package.json with cost control scripts"
echo "   Created quick cost check script"
echo "   âœ… Deployment scripts configured"
echo ""
echo "ğŸ“ Step 5: Creating configuration files..."
echo "   âœ… Configuration files created"
echo ""
echo "ğŸ“¦ Step 6: Installing dependencies..."
echo "   Installing aws-sdk..."
echo "   âœ… Dependencies ready"
echo ""
echo "ğŸ‰ Cost controls successfully connected!"
echo ""
echo "ğŸ“‹ Next Steps:"
echo "1. Review cost-controls-config.json"
echo "2. Run: npm run deploy-with-cost-controls"
echo "3. Monitor your CloudWatch dashboard"
echo ""
echo "âœ… Your existing code remains unchanged!"
echo ""
echo "----------------------------------------"
echo ""

# Example 2: Deploy with cost controls
echo "ğŸ“ Example 2: Deploying with Cost Controls"
echo "------------------------------------------"
echo "$ npm run deploy-with-cost-controls"
echo "ğŸ›¡ï¸  Starting cost-controlled deployment..."
echo ""
echo "ğŸ” Pre-deployment cost validation..."
echo "ğŸ“‹ Synthesizing CDK template..."
echo "âœ… Estimated cost: $47.20/month"
echo "âœ… Within budget: $150/month"
echo ""
echo "ğŸ—ï¸  Deploying cost control infrastructure..."
echo "ğŸš€ Deploying application with cost controls..."
echo "âš™ï¸  Configuring post-deployment cost controls..."
echo "ğŸ·ï¸  Tagging resources for cost tracking..."
echo "ğŸ“Š Setting up cost monitoring dashboard..."
echo ""
echo "ğŸ‰ Deployment completed successfully with cost controls!"
echo ""
echo "ğŸ“Š Monitor your costs at:"
echo "   https://console.aws.amazon.com/cloudwatch/home#dashboards:name=cost-control-my-serverless-app-dev"
echo ""
echo "----------------------------------------"
echo ""

# Example 3: Cost validation failure
echo "ğŸ“ Example 3: Cost Validation Failure"
echo "-------------------------------------"
echo "$ npm run deploy-with-cost-controls"
echo "ğŸ›¡ï¸  Starting cost-controlled deployment..."
echo ""
echo "ğŸ” Pre-deployment cost validation..."
echo "âš ï¸  Estimated cost: $287.50/month (exceeds $150 budget)"
echo ""
echo "âŒ Pre-deployment validation failed:"
echo "   â€¢ Instance type 't3.large' not allowed in dev environment. Use: t3.micro, t3.small"
echo "   â€¢ EBS volume size 500GB exceeds dev limit of 100GB"
echo "   â€¢ Estimated cost ($287.50) exceeds budget ($150)"
echo ""
echo "ğŸ’¡ Recommendations:"
echo "   â€¢ Use t3.small instead of t3.large"
echo "   â€¢ Reduce EBS volume size to 100GB or less"
echo "   â€¢ Consider auto-shutdown for development resources"
echo ""
echo "â“ Continue anyway? [y/N] n"
echo "Deployment cancelled for cost compliance."
echo ""
echo "----------------------------------------"
echo ""

# Example 4: Quick cost check
echo "ğŸ“ Example 4: Quick Cost Monitoring"
echo "-----------------------------------"
echo "$ ./quick-cost-check.sh"
echo "ğŸ’° Quick Cost Check"
echo "=================="
echo "Current spending: $23.47"
echo "Budget: $150/month"
echo ""
echo "ğŸ“Š Full dashboard:"
echo "https://console.aws.amazon.com/cloudwatch/home#dashboards:name=cost-control-my-serverless-app-dev"
echo ""
echo "$ npm run cost-report"
echo "ğŸ“Š Weekly Cost Report"
echo "===================="
echo "Project: my-serverless-app"
echo "Environment: dev"
echo "Period: Last 7 days"
echo ""
echo "ğŸ’° Cost Summary:"
echo "â”œâ”€â”€ Total Spent: $23.47"
echo "â”œâ”€â”€ Budget Used: 15.6% of $150"
echo "â”œâ”€â”€ Daily Average: $3.35"
echo "â””â”€â”€ Projected Monthly: $101.50"
echo ""
echo "ğŸ† Top Resources by Cost:"
echo "1. Lambda Functions: $12.30 (52%)"
echo "2. API Gateway: $6.45 (27%)"
echo "3. CloudWatch Logs: $2.89 (12%)"
echo "4. DynamoDB: $1.83 (8%)"
echo ""
echo "ğŸ’¡ Optimization Recommendations:"
echo "â€¢ Enable Lambda provisioned concurrency optimization"
echo "â€¢ Review CloudWatch log retention policies"
echo "â€¢ Consider DynamoDB on-demand pricing"
echo ""
echo "----------------------------------------"
echo ""

echo "âœ¨ That's how easy it is to add cost controls to any AWS project!"
echo ""
echo "ğŸš€ Ready to protect your AWS costs?"
echo "   npx @aws-cost-control/template"
echo ""
echo "ğŸ“š Full documentation:"
echo "   https://github.com/your-org/aws-cost-control-template"